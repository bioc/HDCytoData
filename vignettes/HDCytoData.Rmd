---
title: "HDCytoData data package"
author: 
  - name: Lukas M. Weber
    affiliation: 
      - &id1 "Institute of Molecular Life Sciences, University of Zurich, Zurich, Switzerland"
      - &id2 "SIB Swiss Institute of Bioinformatics, University of Zurich, Zurich, Switzerland"
  - name: Charlotte Soneson
    affiliation: 
      - *id1
      - *id2
package: HDCytoData
output: 
  BiocStyle::html_document
vignette: >
  %\VignetteIndexEntry{HDCytoData data package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



# Overview

The `HDCytoData` data package contains a set of publicly available high-dimensional flow cytometry and mass cytometry (CyTOF) data sets, formatted into `SummarizedExperiment` and `flowSet` Bioconductor object formats. The data objects are hosted on the Bioconductor ExperimentHub web resource.

The objects contain the cell-level expression values, as well as row and column meta-data, including sample IDs, group IDs, true cell population or cluster labels (where available), protein marker names, and marker information to identify 'cell type' and 'cell state' markers (where relevant).

These data sets have been used for benchmarking purposes in our previous work and publications, e.g. to evaluate the performance of clustering algorithms. They are provided here in the `SummarizedExperiment` and `flowSet` formats to make them easier to access.



# Data sets

Currently, the package contains the following data sets:

- Bodenmiller_BCR_XL

Additional details on each data set are included in the help files for the data sets. For each data set, this includes a description of the data set (biological setting, number of samples, number of cells, number and types of protein markers, etc.), as well as an explanation of the object structures, and references and raw data sources.

The help files can be accessed by the data set names, e.g. `?Bodenmiller_BCR_XL`.



# How to load data

First, we show how to load the data sets.

The data sets can be loaded either with named functions referring directly to the object names, or by using the `ExperimentHub` interface. Both methods are demonstrated below, using the `Bodenmiller_BCR_XL` data set as an example.

For details about the structure of the `SummarizedExperiment` or `flowSet` objects for this data set, see the help file (`?Bodenmiller_BCR_XL`).

Load the data sets using named functions:

```{r}
library(HDCytoData)

# Load 'SummarizedExperiment' object using named function
Bodenmiller_BCR_XL_SE()

# Load 'flowSet' object using named function
Bodenmiller_BCR_XL_flowSet()
```


Alternatively, load the data sets using the `ExperimentHub` interface:

```{r}
# Create an ExperimentHub instance
ehub <- ExperimentHub()

# Query ExperimentHub instance to find data sets
query(ehub, "HDCytoData")

# Load 'SummarizedExperiment' object using index of data set
ehub[["EH1119"]]

# Load 'flowSet' object using index of data set
ehub[["EH1120"]]
```



# Example workflow

We demonstrate the use of the `HDCytoData` package with a short example analysis workflow for one of the data sets.


## Load data

We load the data in `SummarizedExperiment` format for the example workflow.

```{r}
# Load data set in 'SummarizedExperiment' format
d_SE <- Bodenmiller_BCR_XL_SE()

# Inspect the object
d_SE
assay(d_SE)[1:6, 1:6]
rowData(d_SE)
colData(d_SE)
```


## Transform data

Flow and mass cytometry data should be transformed before performing any analysis. For mass cytometry (CyTOF), a commonly used standard transformation is the `arcsinh` with parameter `cofactor = 5`. (For flow cytometry, `cofactor = 150` can be used.) This brings the marker expression profiles closer to normal distributions, which improves clustering performance and visualizations.

We apply the `arcsinh` transform with `cofactor = 5` to all protein marker columns.

```{r}
# Apply transformation to marker columns
cofactor <- 5
cols <- colData(d_SE)$is_marker
assay(d_SE)[, cols] <- asinh(assay(d_SE)[, cols] / cofactor)

summary(assay(d_SE))
```


## Explore data

Generate some plots to explore the data.

```{r}
# Marker expression profiles


# Multi-dimensional scaling (MDS) plot


```


## Clustering

Finally, we perform clustering to define cell populations, and compare the clustering results with the reference cell population labels.

```{r}
# Run clustering


# t-SNE plot with cluster labels


# t-SNE plot with true population labels
```


